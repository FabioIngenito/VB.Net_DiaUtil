Public Class ClsDiaUtilVB

    ''' <summary>
    ''' Calcula o número de dias mínimos para que a data caia em um dia útil.
    ''' </summary>
    ''' <param name="nDias">Dias mínumos base para cálculo.</param>
    ''' <param name="DataBase">Data do Cálculo.</param>
    ''' <param name="bSoma">Adiciona ou subtrai.</param>
    ''' <returns>Retorna o número de dias para cálculo.</returns>
    Public Shared Function NumeroDiasUteis(ByVal nDias As Double,
                                   ByVal DataBase As Nullable(Of DateTime),
                                   Optional ByVal bSoma As Boolean = True) As Decimal
        Dim dtFutura As Date
        Dim bVerifica As Boolean = True

        If DataBase.HasValue = False Then DataBase = Now

        While bVerifica

            dtFutura = DateAdd(DateInterval.Day, nDias, CDate(DataBase))

            If EhFeriadoFinalDeSemana(dtFutura) = True Then

                If bSoma = True Then
                    nDias += 1
                Else
                    nDias -= 1
                End If

            Else
                bVerifica = False
            End If

        End While

        Return nDias
    End Function

    ''' <summary>
    ''' Essa função pode ser substituída por uma consulta a uma base de dados.
    ''' </summary>
    ''' <param name="dtEntrada">Data a ser verificada.</param>
    ''' <returns>Retorna verdadeiro ou falso.</returns>
    Private Shared Function EhFeriadoFinalDeSemana(ByVal dtEntrada As Date) As Boolean

        'Sabadão
        If dtEntrada.DayOfWeek = DayOfWeek.Saturday Then
            Return True
        End If

        'Domingueira
        If dtEntrada.DayOfWeek = DayOfWeek.Sunday Then
            Return True
        End If

        'Dias felizes.... (feriados)
        Select Case dtEntrada.ToString("dd/MM/yyyy")
            Case "01/01/2012", "01/01/2013", "01/01/2014", "01/01/2015", "01/01/2016", "01/01/2017", "01/01/2018", "01/01/2019", "01/01/2020",
                 "01/01/2021", "01/01/2022", "01/01/2023", "01/01/2024", "01/01/2025", "01/01/2026", "01/01/2027", "01/01/2028", "01/01/2029",
                 "01/01/2030", "01/03/2022", "01/05/2012", "01/05/2013", "01/05/2014", "01/05/2015", "01/05/2016", "01/05/2017", "01/05/2018",
                 "01/05/2019", "01/05/2020", "01/05/2021", "01/05/2022", "01/05/2023", "01/05/2024", "01/05/2025", "01/05/2026", "01/05/2027",
                 "01/05/2028", "01/05/2029", "01/05/2030", "02/04/2021", "02/11/2011", "02/11/2012", "02/11/2013", "02/11/2014", "02/11/2015",
                 "02/11/2016", "02/11/2017", "02/11/2018", "02/11/2019", "02/11/2020", "02/11/2021", "02/11/2022", "02/11/2023", "02/11/2024",
                 "02/11/2025", "02/11/2026", "02/11/2027", "02/11/2028", "02/11/2029", "02/11/2030", "03/03/2014", "03/03/2025", "03/04/2015",
                 "03/04/2026", "03/06/2021", "04/03/2014", "04/03/2019", "04/03/2025", "04/03/2030", "04/06/2015", "04/06/2026", "05/03/2019",
                 "05/03/2030", "06/04/2012", "07/04/2023", "07/06/2012", "07/09/2012", "07/09/2013", "07/09/2014", "07/09/2015", "07/09/2016",
                 "07/09/2017", "07/09/2018", "07/09/2019", "07/09/2020", "07/09/2021", "07/09/2022", "07/09/2023", "07/09/2024", "07/09/2025",
                 "07/09/2026", "07/09/2027", "07/09/2028", "07/09/2029", "07/09/2030", "08/02/2016", "08/02/2027", "08/06/2023", "09/02/2016",
                 "09/02/2027", "09/07/2013", "09/07/2014", "09/07/2015", "09/07/2016", "09/07/2017", "09/07/2018", "09/07/2019", "09/07/2020",
                 "09/07/2021", "09/07/2022", "09/07/2023", "09/07/2024", "09/07/2025", "09/07/2026", "09/07/2027", "09/07/2028", "09/07/2029",
                 "09/07/2030", "10/04/2020", "11/02/2013", "11/06/2020", "12/02/2013", "12/02/2018", "12/02/2024", "12/02/2029", "12/10/2012",
                 "12/10/2013", "12/10/2014", "12/10/2015", "12/10/2016", "12/10/2017", "12/10/2018", "12/10/2019", "12/10/2020", "12/10/2021",
                 "12/10/2022", "12/10/2023", "12/10/2024", "12/10/2025", "12/10/2026", "12/10/2027", "12/10/2028", "12/10/2029", "12/10/2030",
                 "13/02/2018", "13/02/2024", "13/02/2029", "13/06/2012", "13/06/2013", "13/06/2014", "13/06/2015", "13/06/2016", "13/06/2017",
                 "13/06/2018", "13/06/2019", "13/06/2020", "13/06/2021", "13/06/2022", "13/06/2023", "13/06/2024", "13/06/2025", "13/06/2026",
                 "13/06/2027", "13/06/2028", "13/06/2029", "13/06/2030", "14/04/2017", "14/04/2028", "15/02/2021", "15/04/2022", "15/06/2017",
                 "15/06/2028", "15/11/2011", "15/11/2012", "15/11/2013", "15/11/2014", "15/11/2015", "15/11/2016", "15/11/2017", "15/11/2018",
                 "15/11/2019", "15/11/2020", "15/11/2021", "15/11/2022", "15/11/2023", "15/11/2024", "15/11/2025", "15/11/2026", "15/11/2027",
                 "15/11/2028", "15/11/2029", "15/11/2030", "16/02/2015", "16/02/2021", "16/02/2026", "16/06/2022", "17/02/2015", "17/02/2026",
                 "18/04/2014", "18/04/2025", "19/04/2019", "19/04/2030", "19/06/2014", "19/06/2025", "20/02/2012", "20/02/2023", "20/06/2019",
                 "20/06/2030", "21/02/2012", "21/02/2023", "21/04/2012", "21/04/2013", "21/04/2014", "21/04/2015", "21/04/2016", "21/04/2017",
                 "21/04/2018", "21/04/2019", "21/04/2020", "21/04/2021", "21/04/2022", "21/04/2023", "21/04/2024", "21/04/2025", "21/04/2026",
                 "21/04/2027", "21/04/2028", "21/04/2029", "21/04/2030", "24/02/2020", "25/02/2020", "25/03/2016", "25/12/2012", "25/12/2013",
                 "25/12/2014", "25/12/2015", "25/12/2016", "25/12/2017", "25/12/2018", "25/12/2019", "25/12/2020", "25/12/2021", "25/12/2022",
                 "25/12/2023", "25/12/2024", "25/12/2025", "25/12/2026", "25/12/2027", "25/12/2028", "25/12/2029", "25/12/2030", "26/03/2027",
                 "26/05/2016", "27/02/2017", "27/05/2027", "28/02/2017", "28/02/2022", "28/02/2028", "29/02/2028", "29/03/2013", "29/03/2024",
                 "30/03/2018", "30/03/2029", "30/05/2013", "30/05/2024", "31/05/2018", "31/05/2029", "31/12/2020", "31/12/2021", "31/12/2024",
                 "31/12/2025", "31/12/2026", "31/12/2027", "31/12/2029", "31/12/2030"

                Return True

        End Select

        'Dia util, que triste...
        Return False 'tudo ok!
    End Function

End Class
